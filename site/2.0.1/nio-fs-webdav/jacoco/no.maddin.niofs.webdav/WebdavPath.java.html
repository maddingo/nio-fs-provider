<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebdavPath.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">nio-fs-webdav</a> &gt; <a href="index.source.html" class="el_package">no.maddin.niofs.webdav</a> &gt; <span class="el_source">WebdavPath.java</span></div><h1>WebdavPath.java</h1><pre class="source lang-java linenums">/*
 Copyright 2012-2013 University of Stavanger, Norway

 Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
 */

package no.maddin.niofs.webdav;

import java.io.File;
import java.io.IOError;
import java.io.IOException;
import java.net.URI;
import java.net.URISyntaxException;
import java.nio.file.FileSystem;
import java.nio.file.LinkOption;
import java.nio.file.Path;
import java.nio.file.WatchEvent.Kind;
import java.nio.file.WatchEvent.Modifier;
import java.nio.file.WatchKey;
import java.nio.file.WatchService;
import java.util.Arrays;
import java.util.Deque;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.StringTokenizer;

/**
 * Denotes a WebDAV Path.  
 */
public class WebdavPath implements Path {

    private static final String NEED_TO_BE_AN_INSTANCE_OF_WEBDAV_PATH = &quot;Need to be an instance of WebdavPath&quot;;
    private static final String PARENT_PATH = &quot;..&quot;;
    private static final String PATH_SEP = &quot;/&quot;;
    private static final String DEFAULT_ROOT_PATH = PATH_SEP;
    private final String path;
    private final WebdavFileSystem host;

<span class="fc" id="L50">    WebdavPath(WebdavFileSystem webdavHost, String path) {</span>
<span class="fc" id="L51">        this.host = webdavHost;</span>
<span class="pc bpc" id="L52" title="1 of 2 branches missed.">        if (path == null) {</span>
<span class="nc" id="L53">            this.path = DEFAULT_ROOT_PATH;</span>
        } else {
<span class="fc" id="L55">            String p = path.trim();</span>
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">            if (!p.startsWith(PATH_SEP)) {</span>
<span class="nc" id="L57">                this.path = PATH_SEP + p;</span>
            } else {
<span class="fc" id="L59">                this.path = p;</span>
            }
        }
<span class="fc" id="L62">    }</span>

    @Override
    public FileSystem getFileSystem() {
<span class="fc" id="L66">        return this.host;</span>
    }

    @Override
    public Path getRoot() {
<span class="nc bnc" id="L71" title="All 2 branches missed.">        if (path.equals(DEFAULT_ROOT_PATH)) {</span>
<span class="nc" id="L72">            return this;</span>
        }
<span class="nc" id="L74">        return new WebdavPath(this.host, DEFAULT_ROOT_PATH);</span>
    }

    @Override
    public boolean isAbsolute() {
<span class="pc bpc" id="L79" title="2 of 4 branches missed.">        return path.length() &gt; 0 &amp;&amp; path.startsWith(PATH_SEP);</span>
    }

    /**
     * @deprecated will be removed in future releases
     * @return the path as String
     */
    @Deprecated
    public String getPathString() {
<span class="nc" id="L88">        return this.path;</span>
    }

    @Override
    public int compareTo(Path other) {
<span class="nc" id="L93">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public boolean endsWith(Path other) {
<span class="nc" id="L98">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public boolean endsWith(String other) {
<span class="nc" id="L103">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path getFileName() {
<span class="nc" id="L108">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path getName(int index) {
<span class="nc" id="L113">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public int getNameCount() {
<span class="nc" id="L118">        return 0;</span>
    }

    @Override
    public Path getParent() {
<span class="pc bpc" id="L123" title="1 of 2 branches missed.">        if (path.equals(DEFAULT_ROOT_PATH)) {</span>
<span class="nc" id="L124">            return null;</span>
        }
<span class="fc" id="L126">        String p1 = this.path;</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">        if (p1.endsWith(PATH_SEP)) {</span>
<span class="fc" id="L128">            p1 = p1.substring(0, p1.length() - 1);</span>
        }
<span class="fc" id="L130">        int lastSep = p1.lastIndexOf(PATH_SEP);</span>
<span class="fc bfc" id="L131" title="All 2 branches covered.">        if (lastSep &gt; 0) {</span>
<span class="fc" id="L132">            String parentString = p1.substring(0, lastSep + 1);</span>
<span class="fc" id="L133">            return new WebdavPath(this.host, parentString);</span>
        }
<span class="fc" id="L135">        return null;</span>
    }

    @Override
    public Iterator&lt;Path&gt; iterator() {
<span class="nc" id="L140">        List&lt;Path&gt; plist = new LinkedList&lt;&gt;();</span>

<span class="nc bnc" id="L142" title="All 2 branches missed.">        for (Path p = this; p != null; p = p.getParent()) {</span>
<span class="nc" id="L143">            plist.add(0, p);</span>
        }
<span class="nc" id="L145">        return plist.iterator();</span>
    }

    @Override
    public Path normalize() {
        try {
<span class="fc" id="L151">            URI normal = new URI(path).normalize();</span>
<span class="fc" id="L152">            return new WebdavPath(this.host, normal.getPath());</span>
<span class="nc" id="L153">        } catch (URISyntaxException e) {</span>
<span class="nc" id="L154">            throw new IllegalArgumentException(path, e);</span>
        }
    }

    @Override
    public WatchKey register(WatchService watcher, Kind&lt;?&gt;... events) throws IOException {
<span class="nc" id="L160">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public WatchKey register(WatchService watcher, Kind&lt;?&gt;[] events, Modifier... arg2) throws IOException {
<span class="nc" id="L165">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path relativize(Path other) {
<span class="nc bnc" id="L170" title="All 2 branches missed.">        if (!(other instanceof WebdavPath)) {</span>
<span class="nc" id="L171">            throw new IllegalArgumentException(NEED_TO_BE_AN_INSTANCE_OF_WEBDAV_PATH);</span>
        }

<span class="nc bnc" id="L174" title="All 2 branches missed.">        if (!other.getFileSystem().equals(this.getFileSystem())) {</span>
<span class="nc" id="L175">            throw new IllegalArgumentException(&quot;Wrong File System Type&quot;);</span>
        }

<span class="nc" id="L178">        Path base = this;</span>
<span class="nc" id="L179">        WebdavPath current = (WebdavPath)other;</span>

<span class="nc" id="L181">        String[] bParts = this.path.split(PATH_SEP);</span>
<span class="nc" id="L182">        String[] cParts = current.path.split(PATH_SEP);</span>

<span class="nc bnc" id="L184" title="All 4 branches missed.">        if (bParts.length &gt; 0 &amp;&amp; !base.toString().endsWith(PATH_SEP)) {</span>
<span class="nc" id="L185">            bParts = Arrays.copyOf(bParts, bParts.length - 1);</span>
        }

<span class="nc" id="L188">        int i = 0;</span>
<span class="nc bnc" id="L189" title="All 6 branches missed.">        while (i &lt; bParts.length &amp;&amp; i &lt; cParts.length &amp;&amp; bParts[i].equals(cParts[i])) {</span>
<span class="nc" id="L190">            i++;</span>
        }

<span class="nc" id="L193">        StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">        for (int j = 0; j &lt; (bParts.length - i); j++) {</span>
<span class="nc" id="L195">            sb.append(PATH_SEP);</span>
        }
<span class="nc bnc" id="L197" title="All 2 branches missed.">        for (int j = i; j &lt; cParts.length; j++) {</span>
<span class="nc bnc" id="L198" title="All 2 branches missed.">            if (j != i) {</span>
<span class="nc" id="L199">                sb.append(PATH_SEP);</span>
            }
<span class="nc" id="L201">            sb.append(cParts[j]);</span>
        }
<span class="nc" id="L203">        return new WebdavPath(this.host, sb.toString());</span>
    }

    @Override
    public Path resolve(Path other) {
<span class="nc bnc" id="L208" title="All 2 branches missed.">        if (other.isAbsolute()) {</span>
<span class="nc" id="L209">            return other;</span>
        }
<span class="nc" id="L211">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path resolve(String other) {
<span class="nc bnc" id="L216" title="All 2 branches missed.">        if (other.startsWith(PATH_SEP)) {</span>
<span class="nc" id="L217">            throw new IllegalArgumentException(other);</span>
        }
<span class="nc" id="L219">        StringBuilder resolvedPath = new StringBuilder(this.path);</span>
<span class="nc bnc" id="L220" title="All 2 branches missed.">        if (!this.path.endsWith(PATH_SEP)) {</span>
<span class="nc" id="L221">            resolvedPath.append(PATH_SEP);</span>
        }
<span class="nc" id="L223">        resolvedPath.append(other);</span>
<span class="nc" id="L224">        return new WebdavPath(this.host, resolvedPath.toString());</span>
    }

    @Override
    public Path resolveSibling(Path other) {
<span class="nc" id="L229">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path resolveSibling(String other) {
<span class="nc" id="L234">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public boolean startsWith(Path other) {
<span class="nc" id="L239">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public boolean startsWith(String other) {
<span class="nc" id="L244">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path subpath(int beginIndex, int endindex) {
<span class="nc" id="L249">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path toAbsolutePath() {
<span class="nc" id="L254">        return this;</span>
    }

    @Override
    public File toFile() {
<span class="nc" id="L259">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public Path toRealPath(LinkOption... options) throws IOException {
<span class="nc" id="L264">        throw new UnsupportedOperationException();</span>
    }

    @Override
    public URI toUri() {
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">        String scheme = (host.provider() instanceof WebdavsFileSystemProvider) ? &quot;https&quot; : &quot;http&quot;;</span>
<span class="fc" id="L270">        String server = host.getHost();</span>
<span class="fc" id="L271">        int port = host.getPort();</span>

        URI sardineUri;
        try {
<span class="fc" id="L275">            sardineUri = new URI(scheme, null, server, port, path, null, null);</span>
<span class="fc" id="L276">            return sardineUri;</span>
<span class="nc" id="L277">        } catch(URISyntaxException e) {</span>
<span class="nc" id="L278">            throw new IOError(e);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>